# 快速问题排查

## ❌ 错误：parse() got an unexpected keyword argument 'progress_callback'

### 问题原因
代码更新后需要重启Streamlit服务才能生效。

### 解决方案

**步骤1: 停止当前运行**
```bash
# 在命令行按 Ctrl+C 停止Streamlit
```

**步骤2: 重新启动**
```bash
# 重新运行
streamlit run app.py

# 或使用启动脚本
./启动系统.bat
```

**步骤3: 刷新浏览器**
```
在浏览器中按 Ctrl+R 或 F5 刷新页面
```

---

## 📊 完整的重启流程

```
① 命令行窗口按 Ctrl+C
    ↓
② 等待服务停止（显示"Stopping..."）
    ↓
③ 重新运行：streamlit run app.py
    ↓
④ 等待启动（显示"You can now view your Streamlit app..."）
    ↓
⑤ 浏览器刷新（Ctrl+R）
    ↓
⑥ 重新上传文件测试
```

---

## ✅ 重启后的新功能

### 1. 实时进度条
```
━━━━━━━━━━ 46%
正在处理第 23/50 页
```

### 2. OCR进度显示
```
━━━━━━━━━━ 46%
OCR识别第 23/50 页...
```

### 3. 超时保护
```
单页OCR超时（>30秒）→ 自动跳过 → 继续下一页
```

### 4. 失败页面提示
```
✅ 已上传并解析: xxx.pdf
📄 共 50 页
🔍 已使用OCR识别 47/50 页
⚠️ 3 页OCR识别失败或超时（第12,35,48页）
```

---

## 🧪 验证新功能

### 测试1: 文本层PDF（快速）

```
上传200页的招标文件正文.pdf
    ↓
看到进度条快速推进：
━━━━━━━━━━ 100%
正在处理第 200/200 页
    ↓
3-5秒完成 ✅
    ↓
✅ 已上传并解析: xxx.pdf (50.2MB)
📄 共 237 页
```

### 测试2: 扫描版PDF（慢速）

```
上传扫描版施工设计说明.pdf
    ↓
看到进度条和OCR提示：
━━━━━━━━━━ 12%
OCR识别第 6/50 页...
    ↓
每页约2-5秒，实时更新
    ↓
如果某页超时：
━━━━━━━━━━ 46%
OCR识别第 23/50 页...（卡住30秒）
    ↓
自动跳过，继续：
━━━━━━━━━━ 48%
OCR识别第 24/50 页...
    ↓
完成后显示：
✅ 已上传并解析
🔍 已使用OCR识别 47/50 页
⚠️ 3 页OCR识别失败
```

---

## 🎯 关于您的疑问

### Q: 200页秒传，数据准备好了吗？

**A: 是的！完全准备好了！**

```python
# 验证方法（临时调试）
# 在标书分析Tab添加：
st.write("招标文件正文字符数:", len(st.session_state.uploaded_files_content.get('招标文件正文', '')))

# 如果显示 50000+ 字符，说明数据完整
```

**原因**：
- 文本层PDF提取非常快（每页0.02秒）
- 200页只需4秒
- 不需要OCR，直接读取文本层

---

## 💡 操作建议

### 方案A: 重启后重新上传（推荐）

1. Ctrl+C 停止服务
2. `streamlit run app.py` 重新启动
3. 浏览器刷新
4. 重新上传3个文件
5. 观察实时进度

### 方案B: 如果OCR太慢，临时关闭OCR

```python
# 修改 app.py 第25行
document_parser = DocumentParser(
    enable_ocr=False,  # 临时关闭OCR
    extract_tables=False
)
```

**效果**：
- 扫描版页面会显示 "[页面无文本层]"
- 但上传速度很快
- 后续可以手动处理扫描版PDF

---

## 🔍 错误诊断

### 错误信息
```
parse() got an unexpected keyword argument 'progress_callback'
```

### 原因
Streamlit缓存了旧版本的代码，需要重启才能加载新代码。

### 解决
**重启Streamlit服务**即可。

---

**现在请按以下步骤操作**：

1. ⏹️ Ctrl+C 停止当前服务
2. 🔄 `streamlit run app.py` 重新启动
3. 🔃 浏览器刷新（Ctrl+R）
4. 📤 重新上传文件，观察实时进度条

应该就能正常工作了！