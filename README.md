# 智能标书审查系统 (智标领航)

一个基于 Streamlit 和 Claude AI 的工程类标书智能审查与技术标生成系统。支持多格式文件上传、结构化智能解析和分步生成技术标文档。

## 功能特性

### 核心功能
- **多格式文件解析**: 支持 PDF、Word、Excel 三种格式自动解析
- **结构化智能解析**: 7大类别深度解析招标文件（基础信息、资格要求、评审要求、投标文件要求、无效标与废标项、应标需提交文件、招标文件审查）
- **评审标准提取**: 自动提取评审标准，为技术标生成提供依据
- **技术标目录生成**: 基于评审标准自动生成结构化技术标目录
- **分步章节生成**: 支持按章节分步生成技术标内容，进度可控
- **历史记录管理**: 项目数据持久化，支持加载历史项目继续编辑
- **导出功能**: 支持 Markdown 和 TXT 格式导出解析报告和技术标文档

### 工作流程
1. **文件上传阶段**: 上传招标文件正文及附件（6个类别，均可选）
2. **智能分析阶段**: AI进行7大类别结构化解析，自动提取评审标准
3. **技术标生成阶段**:
   - 生成技术标目录结构（带建议字数）
   - 分步生成各个章节内容
   - 导出完整技术标文档

## 技术栈

- **应用框架**: Streamlit 1.31.0
- **AI模型**: Anthropic Claude Sonnet 4 (claude-sonnet-4-20250514)
- **文档处理**:
  - PyMuPDF 1.23.22 (PDF解析)
  - python-docx 1.1.0 (Word解析)
  - openpyxl 3.1.2 + pandas 2.2.0 (Excel解析)
- **数据库**: SQLite + SQLAlchemy 2.0.27

## 安装说明

### 1. 安装依赖

```bash
pip install -r requirements.txt
```

### 2. 配置 API Key

复制 `.env.example` 为 `.env` 并填入你的 Claude API Key：

```bash
cp .env.example .env
```

编辑 `.env` 文件：
```
ANTHROPIC_API_KEY=your_actual_api_key
```

### 3. 运行系统

```bash
streamlit run app.py

系统将在浏览器中自动打开，默认地址：http://localhost:8501

## 快速开始

### 第一步：环境配置

1. **安装依赖**
   ```bash
   pip install -r requirements.txt
   ```

2. **配置 API Key**
   ```bash
   # 复制环境变量示例
   cp .env.example .env

   # 编辑 .env 文件，填入你的 Claude API Key
   # ANTHROPIC_API_KEY=sk-ant-api03-xxx...
   ```

### 第二步：启动系统

**Windows 用户**:
```bash
# 方法1: 双击启动脚本
启动系统.bat

# 方法2: 命令行启动
streamlit run app.py
```

**Mac/Linux 用户**:
```bash
./start.sh
# 或
streamlit run app.py
```

系统会自动在浏览器打开 `http://localhost:8501`

### 第三步：使用系统

#### 📄 文件上传
1. 填写项目名称（必填）
2. 上传招标文件（6个类别，均可选）：
   - **招标文件**: 招标文件正文、技术要求附件
   - **招标文件附件**: 工程量清单、评审标准附件、施工设计说明、方案建议书附件
3. 点击 `💾 保存项目`

#### 📊 标书分析
1. 切换到"标书分析"标签页
2. 点击 `🚀 开始结构化解析`（约需1-2分钟）
3. 查看7大类别解析结果
4. 系统自动提取评审标准
5. 可导出解析报告（MD/TXT格式）

#### 📝 技术标生成
1. 切换到"投标文件生成"标签页
2. 点击 `🏗️ 生成技术标目录`（基于评审标准）
3. 选择章节，点击 `✍️ 生成此章节`
4. 重复生成所有章节
5. 点击 `📥 导出完整技术标`

详细操作指南请参阅 [使用说明.md](./使用说明.md)

## 项目结构

```
.
├── app.py                     # Streamlit 主应用程序 (核心文件)
├── modules/                   # 核心模块目录
│   ├── __init__.py           # 模块初始化
│   ├── document_parser.py    # 文档解析模块 (支持PDF/Word/Excel)
│   ├── ai_service.py         # Claude API 服务封装
│   ├── database.py           # 数据库管理 (SQLAlchemy ORM)
│   └── prompts.py            # AI提示词模板库
├── database/                  # 上传文件存储目录 🔴 重要变更
├── data/                      # 数据库文件目录
│   └── bidding_system.db     # SQLite 数据库
├── .streamlit/                # Streamlit 配置目录
├── requirements.txt           # Python 依赖包
├── .env                       # 环境变量配置 (需自行创建)
├── .env.example              # 环境变量示例
├── README.md                 # 项目说明文档
├── CLAUDE.md                 # Claude Code 开发指南
├── 使用说明.md                # 用户操作手册
├── 项目结构说明.md            # 详细架构文档
├── test_setup.py             # 环境配置测试脚本
├── 启动系统.bat               # Windows 快捷启动脚本
└── start.sh                  # Mac/Linux 启动脚本
```

**重要说明**:
- 上传文件存储在 `database/` 目录（非 `uploads/`）
- 支持6类文件上传：招标文件正文、技术要求附件、工程量清单、评审标准附件、施工设计说明、方案建议书附件

## 注意事项

- 确保网络可以访问 Anthropic API
- 建议使用 Python 3.9 或更高版本
- 首次运行会自动创建必要的文件夹和数据库

## 系统特色

### 智能解析
- **7大类别结构化解析**: 覆盖基础信息、资格要求、评审标准等全方位内容
- **风险识别**: 自动识别保证金、付款、知识产权、工期、法律法规等6大风险
- **公平性审查**: 识别准入、得分、信用、保证金、定标等5个维度的公平性问题

### 技术标生成
- **目录智能生成**: 基于评审标准自动生成技术标目录，包含建议字数
- **分步可控**: 支持逐章节生成，每个章节独立控制
- **专业规范**: 输出符合招标行业标准，语言专业精练

### 数据管理
- **历史记录**: 所有项目数据本地持久化，支持加载继续编辑
- **文件关联**: 项目删除时自动清理关联文件
- **搜索功能**: 快速搜索历史项目

## 常见问题

### Q: 上传文件时提示403错误
**A**: 使用 `启动系统.bat` 启动，或手动执行：
```bash
streamlit run app.py --server.enableCORS false --server.enableXsrfProtection false
```

### Q: API调用失败
**A**: 检查以下几点：
1. `.env` 文件中的 `ANTHROPIC_API_KEY` 是否正确
2. 网络是否能访问 Anthropic API
3. API Key 是否有足够的配额

### Q: 解析时间过长
**A**: 正常现象。结构化解析通常需要1-2分钟，章节生成需30-60秒。请耐心等待，不要刷新页面。

### Q: 如何切换模型
**A**: 编辑 `modules/ai_service.py`，修改第49行：
```python
self.model = "claude-opus-4-20250514"  # 使用更强大的Opus模型
```

## 后续扩展计划

- [ ] 支持 Word/PDF 格式导出（目前仅支持MD/TXT）
- [ ] 批量项目处理功能
- [ ] 技术标模板库管理
- [ ] 章节内容自定义修改功能
- [ ] 评审标准可视化展示
- [ ] 用户认证与权限管理
- [ ] 支持更多文件格式（如CAD图纸文本提取）

## 开发指南

开发者请参阅 [CLAUDE.md](./CLAUDE.md) 获取详细的开发指南，包括：
- 项目架构详解
- 添加新文件格式支持
- 自定义AI提示词
- 数据库扩展
- 代码规范

## 更新日志

### v1.0.0 (2026-01-15)
- ✅ 完成基础框架搭建
- ✅ 实现7大类别结构化解析
- ✅ 实现评审标准自动提取
- ✅ 实现技术标分步生成
- ✅ 添加历史记录管理
- ✅ 支持MD/TXT格式导出
