# 智能标书审查系统 - 使用指南

## 快速开始

### 1. 安装依赖

**Windows 用户**:
```bash
pip install -r requirements.txt
```

**Mac/Linux 用户**:
```bash
pip3 install -r requirements.txt
```

### 2. 配置 API Key

1. 复制 `.env.example` 文件并重命名为 `.env`
2. 编辑 `.env` 文件,填入你的 Anthropic Claude API Key:

```
ANTHROPIC_API_KEY=sk-ant-api03-xxxxxxxxxxxx
```

如果还没有 API Key,请访问: https://console.anthropic.com/

### 3. 启动系统

**方法一:使用启动脚本(推荐)**

Windows 双击运行: `启动系统.bat`

Mac/Linux 执行:
```bash
chmod +x start.sh
./start.sh
```

**方法二:手动启动**
```bash
streamlit run app.py
```

系统将自动在浏览器中打开,默认地址: http://localhost:8501

---

## 完整使用流程

系统分为三个阶段:文件上传 → 标书分析 → 技术标生成

### 📄 阶段一:文件上传

1. **填写项目名称**:在顶部输入框输入项目名称(必填)

2. **上传文件**:根据实际情况上传文件(所有文件都是可选的)

   **招标文件(前2项)**:
   - 招标文件正文(支持 PDF/Word/Excel)
   - 技术要求附件(支持 PDF/Word/Excel)

   **招标文件附件(后4项)**:
   - 工程量清单(通常为 Excel)
   - 评审标准附件(支持 PDF/Word/Excel)
   - 施工设计说明(支持 PDF/Word/Excel/CAD)
   - 方案建议书附件(支持 PDF/Word/Excel)

3. **保存项目**:点击 `💾 保存项目` 按钮

   ✅ 看到"项目已保存"提示后,继续下一步

**注意**:
- 所有6个文件类型都是可选的,可根据实际需要上传
- 系统支持 PDF、Word(.docx/.doc)、Excel(.xlsx/.xls)格式
- 文件会自动解析并提取文本内容
- 上传后文件会实时显示在界面上,可以预览

---

### 📊 阶段二:标书分析(结构化解析)

1. **切换到"标书分析"标签页**
   - 在页面顶部找到三个标签:`📄 文件上传` | `📊 标书分析` | `📝 投标文件生成`
   - 点击 `📊 标书分析`

2. **开始结构化解析**:点击 `🚀 开始结构化解析` 按钮
   - 等待1-2分钟,AI会对招标文件进行7大类别的结构化解析
   - 系统会显示处理进度和预估token数

3. **查看解析结果**(左右分栏显示):

   **左侧:7大类别的结构化解析结果**
   1. **基础信息**:招标人、项目信息、关键时间、采购要求等
   2. **资格要求**:资格性审查、符合性审查等
   3. **评审要求**:评分标准、开标评标流程、定标与中标规定
   4. **投标文件要求**:投标文件组成、格式、份数等
   5. **无效标与废标项**:不得存在的情形、否决条件
   6. **应标需提交文件**:文件清单、证明材料
   7. **招标文件审查**:
      - 条款风险审查(6大风险):保证金、付款、知识产权、工期、法律法规、合规条款
      - 公平性审查(5个维度):准入、得分、信用、保证金、定标

   **右侧:原始招标文件内容**
   - 可选择不同文件查看
   - 方便对照核实解析结果

4. **自动提取评审标准**
   - 解析完成后,系统会自动从解析报告中提取评审标准
   - 评审标准是生成技术标的核心依据
   - 包含:招标文件项目需求 + 详细评审标准(含评分细则)

5. **导出解析报告**(可选):
   - 点击 `📥 导出解析报告(MD)` 或 `📥 导出解析报告(TXT)`
   - 可将7大类别解析结果保存为文件

---

### 📝 阶段三:技术标文件生成

1. **切换到"投标文件生成"标签页**
   - 点击顶部的 `📝 投标文件生成` 标签

2. **生成技术标目录**:
   - 点击 `🏗️ 生成技术标目录` 按钮
   - AI会根据评审标准自动生成技术标的目录结构
   - 目录中会标注每个章节的建议字数

   **技术标目录通常包含**:
   - **一、技术文件**
     - 评分点
     - 项目总体认识与建设意义
     - 施工组织总体设想与管理目标
     - 对招标文件实质性条款的响应承诺
     - 绿色施工与信息化管理总体策略

   - **二、项目经理视频陈述及答辩**
     - 项目经理基本情况与业绩介绍
     - 对本项目的理解与实施构想
     - 关键工序把控与团队管理思路
     - 应急响应与协调能力展示要点

   - **三、施工组织设计**(严格对应评审标准)
     - 工程概况
     - 主要施工方法
     - 拟投入的主要物资计划
     - 拟投入的主要施工机械、设备计划
     - 劳动力安排计划
     - 确保工程质量的技术组织措施
     - 确保安全生产的技术组织措施
     - 确保工期的技术组织措施
     - 确保文明施工的技术组织措施
     - 施工总平面布置图
     - 重点、难点

3. **分步生成章节**:
   - 在下拉框中选择要生成的章节
   - 点击 `✍️ 生成此章节` 按钮(通常需要30-60秒)
   - 重复此步骤,逐个生成所有章节
   - 系统会显示进度:`📊 进度: X/Y 个章节已生成`

   **生成特点**:
   - 紧密结合项目实际情况
   - 充分响应评审标准要求
   - 语言专业、精练、有针对性
   - 字数控制在建议范围内(允许±20%浮动)

4. **查看已生成章节**:
   - 点击章节名称可展开查看内容
   - 每个章节下方会显示字数统计
   - 可以重新生成不满意的章节(会覆盖原内容)

5. **导出完整技术标文档**:
   - 点击 `📥 导出完整技术标(MD)` 或 `📥 导出完整技术标(TXT)`
   - 系统会将所有已生成的章节合并成完整文档
   - 下载后可进一步编辑和格式化

---

## 历史记录管理

### 查看历史项目
- 左侧边栏显示所有历史项目
- 展示项目名称、创建时间、状态
- 点击项目可展开查看详情

### 加载历史项目
- 点击 `📂 加载` 按钮可重新加载历史项目
- 所有文件和分析结果会自动恢复
- 可以继续编辑或生成新章节

### 删除项目
1. 点击 `🗑️ 删除` 按钮
2. 系统会显示确认对话框,列出将要删除的内容:
   - 数据库记录
   - 关联的上传文件
3. 点击 `✅ 确认删除` 完成删除

### 新建项目
- 点击左侧边栏底部的 `➕ 新建项目` 按钮
- 系统会清空当前状态,开始新项目

---

## 常见问题

### Q1: 上传文件时提示403错误

**解决方案**:
1. 使用 `启动系统.bat` 启动(已禁用XSRF保护)
2. 或使用此命令启动:
   ```bash
   streamlit run app.py --server.enableCORS false --server.enableXsrfProtection false
   ```
3. 清除浏览器缓存和Cookie后重试

### Q2: 文件上传后找不到下一步操作

**解决方案**:
1. 确保点击了 `💾 保存项目` 按钮
2. 切换到顶部的 `📊 标书分析` 标签页
3. 点击 `🚀 开始结构化解析` 按钮

### Q3: AI处理时间过长

**说明**:
- 结构化解析通常需要1-2分钟
- 章节生成通常需要30-60秒
- 请耐心等待,不要刷新页面
- 可以查看浏览器控制台确认系统正在处理

### Q4: 生成的技术标内容不满意怎么办

**解决方案**:
- 可以重新点击生成按钮覆盖之前的内容
- 尝试多次生成,选择最满意的版本
- 也可以下载后手动编辑修改
- 如果评审标准提取不准确,可以重新分析

### Q5: 如何修改 AI 模型

在 `modules/ai_service.py` 中修改第49行:
```python
self.model = "claude-opus-4-20250514"  # 使用更强大的Opus模型(成本更高)
```

可选模型:
- `claude-sonnet-4-20250514`(默认,平衡性能和成本)
- `claude-opus-4-20250514`(最强性能,成本较高,质量更好)

### Q6: 使用 OpenRouter 等代理服务

在 `.env` 文件中配置:
```bash
ANTHROPIC_BASE_URL=https://openrouter.ai/api/v1
ANTHROPIC_MODEL=anthropic/claude-sonnet-4
```

### Q7: 文件解析失败

**可能原因**:
- 文件格式不支持或损坏
- 文件被加密或有密码保护
- 文件内容为扫描图片(无法提取文字)

**解决方法**:
- 确认文件格式为 PDF、Word 或 Excel
- 尝试重新保存文件
- 移除文件密码保护
- 对于扫描PDF,需要先进行OCR识别

### Q8: 评审标准提取不准确

**解决方案**:
- 确保上传了包含评审标准的文件(如评审标准附件)
- 检查招标文件正文中是否有详细的评审标准章节
- 可以在标书分析阶段手动查看"评审要求"类别
- 如果AI提取遗漏,可以在技术标生成时手动补充

---

## 系统架构说明

### 文件存储位置
- **上传文件**: `database/` 目录(带时间戳的文件名)
- **数据库**: `data/bidding_system.db`(SQLite)

### 数据保存机制
- 上传文件后即自动保存到本地 `database/` 目录
- 点击"保存项目"会保存到数据库
- AI分析结果和生成内容自动保存
- 关闭浏览器后数据不会丢失
- 可通过历史记录重新加载

### 目录结构
```
智能标书审查系统/
├── app.py                    # Streamlit 主应用(876行)
├── modules/                  # 核心模块
│   ├── document_parser.py    # 文档解析(PDF/Word/Excel)(175行)
│   ├── ai_service.py         # Claude API 封装(412行)
│   ├── prompts.py            # AI提示词模板库(405行)
│   └── database.py           # SQLite 数据库管理(150行)
├── database/                 # 上传文件存储 🔴 重要
├── data/                     # 数据库文件
│   └── bidding_system.db     # SQLite 数据库
├── requirements.txt          # Python 依赖
├── .env                      # 环境配置(需自行创建)
├── README.md                 # 项目说明
├── CLAUDE.md                 # Claude Code 开发指南
├── 使用说明.md                # 操作手册
└── 项目结构说明.md            # 详细架构文档
```

---

## 数据安全

- 所有数据存储在本地,不会上传到云端
- 上传的文件保存在 `database/` 目录
- 项目记录保存在本地 SQLite 数据库
- **只有文件内容会发送到 Claude API 进行分析**
- API通信使用HTTPS加密
- 建议敏感项目使用私有部署的AI服务

---

## 技术支持

如遇问题,请检查:
1. Python 版本是否 ≥ 3.9
2. 所有依赖是否正确安装(`pip install -r requirements.txt`)
3. `.env` 配置是否正确(API Key是否有效)
4. 网络连接是否正常(能否访问 Anthropic API)
5. 查看终端输出的错误信息

---

## 更新日志

### v1.0.0 (2026-01-15)
- ✅ 完成基础框架搭建
- ✅ 实现7大类别结构化解析
- ✅ 实现评审标准自动提取
- ✅ 实现技术标分步生成
- ✅ 添加历史记录管理
- ✅ 支持MD/TXT格式导出
- ✅ 6个可选文件上传类别
- ✅ 集中化AI提示词管理

---

**Happy Bidding!** 祝你投标顺利!
