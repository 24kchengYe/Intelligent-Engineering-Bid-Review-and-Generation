# 配置检查清单

## ✅ 您的配置总结

### .env 文件配置

```bash
AI_PROVIDER=openai                                    ✅
OPENAI_API_KEY=sk-or-v1-ea3fd127...                  ✅
OPENAI_BASE_URL=https://openrouter.ai/api/v1          ✅
OPENAI_MODEL=openai/gpt-4o-mini                       ✅
```

**状态**: ✅ 配置完整！

---

## 🔧 需要修改的地方

### 已完成的修改

✅ `modules/ai_provider.py` - AI Provider抽象层
✅ `modules/ai_service.py` - 所有API调用已替换为provider
✅ `modules/document_exporter.py` - Word导出模块
✅ `app.py` - Word导出按钮
✅ `.env` - OpenRouter配置
✅ `requirements.txt` - openai依赖

### 依赖安装

```bash
# 检查是否已安装
pip list | grep openai

# 如果没有，安装：
pip install openai>=1.0.0
```

---

## 🚀 启动流程

### 第1步: 停止当前服务

```bash
# 在运行streamlit的命令行窗口按 Ctrl+C
```

### 第2步: 重新启动

```bash
streamlit run app.py
```

### 第3步: 查看启动日志

**应该看到**：
```
[AI Provider] 使用OpenAI - 模型: openai/gpt-4o-mini
[AI Provider] API端点: https://openrouter.ai/api/v1

You can now view your Streamlit app in your browser.
Local URL: http://localhost:8501
```

**如果看到错误**：
```
ValueError: 未找到 OPENAI_API_KEY
```
→ 检查.env文件是否在项目根目录

---

## 🧪 功能测试

### 测试1: 验证使用的模型

```
1. 启动服务
2. 查看命令行日志
3. 确认显示：
   [AI Provider] 使用OpenAI - 模型: openai/gpt-4o-mini
```

### 测试2: 上传文件

```
1. 切换到"文件上传"Tab
2. 上传招标文件正文.pdf
3. 观察进度条和状态
4. 确认上传成功
```

### 测试3: 导出原始数据

```
1. 切换到"标书分析"Tab
2. 点击"📥 导出原始数据"
3. 下载TXT文件
4. 打开查看是否有完整文本
```

### 测试4: AI分析（关键！）

```
1. 在"标书分析"Tab
2. 点击"🚀 开始结构化解析"
3. 等待分析完成（30-120秒）
4. 查看解析报告质量
5. 检查是否使用了gpt-4o-mini（成本应该很低）
```

### 测试5: Word导出

```
1. 分析完成后
2. 点击"📥 导出(Word)"
3. 等待生成（2-5秒）
4. 点击"💾 下载Word文档"
5. 打开Word文档查看排版
```

---

## 💡 验证成本

### 在OpenRouter后台查看

1. 访问：https://openrouter.ai/activity
2. 查看最近的API调用
3. 确认模型：openai/gpt-4o-mini
4. 查看成本：应该只有几分钱

**如果成本很高（几美元）** → 可能调用了错误的模型，检查配置

---

## ⚠️ 常见问题排查

### 问题1: 启动时报错 "未找到 OPENAI_API_KEY"

**原因**: .env文件不在项目根目录，或文件名错误

**解决**:
```bash
# 检查文件位置
ls -la .env

# 应该显示：
.env

# 如果没有，创建：
cp .env.example .env
# 然后填写配置
```

### 问题2: 日志显示Claude模型

**原因**: AI_PROVIDER配置错误或未设置

**解决**:
```bash
# 检查.env第一行
AI_PROVIDER=openai  # 必须是这个

# 如果是 claude 或没有这行，修改为 openai
```

### 问题3: OpenRouter返回401错误

**原因**: API Key错误或过期

**解决**:
```bash
# 检查API Key格式
OPENAI_API_KEY=sk-or-v1-xxxxx  # 必须是这个格式

# 在OpenRouter后台检查：
# - Key是否有效
# - 是否有余额
```

---

## 📋 完整配置对比

### 您的配置（OpenRouter）

```bash
AI_PROVIDER=openai
OPENAI_API_KEY=sk-or-v1-xxxxx
OPENAI_BASE_URL=https://openrouter.ai/api/v1
OPENAI_MODEL=openai/gpt-4o-mini
```

### PyCharm配置（不会被使用）

```bash
ANTHROPIC_API_KEY=sk-ant-xxxxx  # 被忽略
ANTHROPIC_MODEL=claude-opus-4   # 被忽略
```

**结果**: 完全隔离！✅

---

## 🎯 最终检查

运行以下命令验证配置：

```bash
# 1. 检查.env文件
cat .env | grep AI_PROVIDER
# 应该显示：AI_PROVIDER=openai

# 2. 检查模型配置
cat .env | grep OPENAI_MODEL
# 应该显示：OPENAI_MODEL=openai/gpt-4o-mini

# 3. 重启服务并查看日志
streamlit run app.py

# 应该看到：
[AI Provider] 使用OpenAI - 模型: openai/gpt-4o-mini  ✅
```

---

**配置已完成！现在重启服务测试即可！** 🎉
